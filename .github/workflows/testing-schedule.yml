name: Testing Scheduled ENVs
on:
  push:
    branches:
      - main
    paths-ignore:
      - 'README.md'
      - 'LICENSE'
  schedule:
    - cron: '15 0 * * *'
    - cron: '20 0 * * *'
    - cron: '25 0 * * *'

env:
  VERSION: ${{ ( github.event.schedule == '15 0 * * *' && '8.2' ) || ( github.event.schedule == '20 0 * * *' && '8.1' ) || ( github.event.schedule == '25 0 * * *' && '8.0' ) ||  'null' }}
  VVV: "FOOBAR"

jobs:
  get-latest-commit:
    runs-on: ubuntu-latest
    steps:       
      - name: Inspect event
        run: |
          date
          echo "VERSION: $VERSION"
          echo "VVV: $VVV"
          echo "Event Name: ${GITHUB_EVENT_NAME}"
          cat ${GITHUB_EVENT_PATH}

      - name: Get variants
        id: get-variants
        run: |
          echo Getting Variants for version ${{ env.version }}
          curl -kL -o php.json https://github.com/sohmc/docker-image-library-jsonizer/releases/latest/download/php
          VARIANTS=$(jq -cr --arg VERSION ${{ env.version }} '[.tags[].Directory | select(startswith($VERSION))]' php.json)
          echo Variants: ${VARIANTS}
          echo "variants=$VARIANTS" >> $GITHUB_OUTPUT

